<!-- Widget de Status do Trial -->
{% if trial_info %}
<div class="col-md-12 mb-4">
    <div class="card border-{{ trial_info.status_class }} shadow-sm">
        <div class="card-header bg-{{ trial_info.status_class }} text-white">
            <div class="row align-items-center">
                <div class="col">
                    <h6 class="mb-0">
                        <i class="fas fa-clock me-2"></i>
                        Status do Trial - {{ trial_info.status_texto }}
                    </h6>
                </div>
                <div class="col-auto">
                    {% if trial_info.status == 'expirado' %}
                        <span class="badge bg-light text-dark">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            Expirado
                        </span>
                    {% else %}
                        <span class="badge bg-light text-dark">
                            {{ trial_info.dias_restantes }} dia{{ trial_info.dias_restantes|pluralize:",s" }} restante{{ trial_info.dias_restantes|pluralize:",s" }}
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <!-- Barra de Progresso -->
                    <div class="mb-3">
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar bg-{{ trial_info.status_class }}" 
                                 role="progressbar" 
                                 style="width: {{ trial_info.porcentagem_usado }}%"
                                 aria-valuenow="{{ trial_info.porcentagem_usado }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100">
                            </div>
                        </div>
                        <small class="text-muted">
                            {{ trial_info.dias_decorridos }}/{{ trial_info.total_dias }} dias utilizados
                        </small>
                    </div>
                    
                    <!-- Informações Detalhadas -->
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="border-end">
                                <h6 class="text-muted mb-1">Início</h6>
                                <p class="mb-0 fw-bold">{{ trial_info.data_cadastro|date:"d/m/Y" }}</p>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="border-end">
                                <h6 class="text-muted mb-1">Expira em</h6>
                                <p class="mb-0 fw-bold">{{ trial_info.data_expiracao|date:"d/m/Y" }}</p>
                            </div>
                        </div>
                        <div class="col-4">
                            <h6 class="text-muted mb-1">Status</h6>
                            <p class="mb-0 fw-bold text-{{ trial_info.status_class }}">
                                {% if trial_info.status == 'expirado' %}
                                    <i class="fas fa-times-circle"></i> Expirado
                                {% elif trial_info.status == 'ultimo_dia' %}
                                    <i class="fas fa-exclamation-triangle"></i> Último Dia
                                {% elif trial_info.status == 'expirando' %}
                                    <i class="fas fa-hourglass-half"></i> Expirando
                                {% else %}
                                    <i class="fas fa-check-circle"></i> Ativo
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="text-center">
                        {% if trial_info.status == 'expirado' %}
                            <div class="alert alert-danger mb-3">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>Trial Expirado!</strong><br>
                                Escolha um plano para continuar.
                            </div>
                        {% elif trial_info.urgente %}
                            <div class="alert alert-warning mb-3">
                                <i class="fas fa-clock"></i>
                                <strong>Ação Necessária!</strong><br>
                                Seu trial expira em breve.
                            </div>
                        {% else %}
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle"></i>
                                <strong>Trial Ativo</strong><br>
                                Explore todas as funcionalidades!
                            </div>
                        {% endif %}
                        
                        <a href="{% url 'admin_loja:planos_comparar' %}" 
                           class="btn btn-{% if trial_info.urgente %}warning{% else %}primary{% endif %} btn-sm w-100">
                            <i class="fas fa-crown me-1"></i>
                            {% if trial_info.status == 'expirado' %}
                                Escolher Plano Agora
                            {% else %}
                                Ver Planos Disponíveis
                            {% endif %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        {% if trial_info.status != 'expirado' %}
        <div class="card-footer bg-light">
            <div class="row text-center">
                <div class="col">
                    <small class="text-muted">
                        <i class="fas fa-gift me-1"></i>
                        <strong>Durante o trial você tem acesso completo a todas as funcionalidades!</strong>
                    </small>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Script para atualização automática -->
<script>
// Atualizar informações do trial a cada minuto
setInterval(function() {
    // Recarregar apenas se estiver próximo do fim
    {% if trial_info.dias_restantes <= 1 %}
        if (document.visibilityState === 'visible') {
            location.reload();
        }
    {% endif %}
}, 60000); // 1 minuto

// Notificação visual se trial expirou
{% if trial_info.status == 'expirado' %}
document.addEventListener('DOMContentLoaded', function() {
    // Piscar suavemente o widget
    const widget = document.querySelector('.card.border-danger');
    if (widget) {
        setInterval(function() {
            widget.style.opacity = widget.style.opacity === '0.7' ? '1' : '0.7';
        }, 2000);
    }
});
{% endif %}
</script>

<style>
.card.border-danger {
    animation: pulse-border 3s infinite;
}

@keyframes pulse-border {
    0% { border-color: #dc3545; }
    50% { border-color: #ff6b7a; }
    100% { border-color: #dc3545; }
}
</style>
{% endif %}
