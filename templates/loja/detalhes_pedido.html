{% extends "base.html" %}
{% block title %}Detalhes do Pedido{% endblock %}
{% block content %}
<div class="container py-4">
  <h2>Detalhes do Pedido</h2>
  {% if pedido %}
    <div class="mb-3">
      <strong>Código:</strong> {{ pedido.codigo }}<br>
      <strong>Status:</strong> {{ pedido.status }}<br>
      <strong>Cliente:</strong> {{ pedido.cliente.nome }}<br>
      <strong>Data:</strong> {{ pedido.criado_em|date:"d/m/Y H:i" }}<br>
      <strong>Valor Total:</strong> R$ {{ pedido.valor_total }}
    </div>
    <h5>Itens do Pedido</h5>
    <ul>
      {% for item in pedido.itens.all %}
        <li>
          {{ item.quantidade }}x {{ item.nome }} - R$ {{ item.preco_total }}
          {% if item.personalizacoes.all %}
            <br><small>
              <strong>Personalizações:</strong>
              {% regroup item.personalizacoes.all by opcao_nome as opcoes_agrupadas %}
              {% for opcao_grupo in opcoes_agrupadas %}
                <br>&nbsp;&nbsp;<strong>{{ opcao_grupo.grouper }}:</strong>
                {% for p in opcao_grupo.list %}{{ p.item_nome }}{% if p.preco_adicional > 0 %} (+R$ {{ p.preco_adicional|floatformat:2 }}){% endif %}{% if not forloop.last %}, {% endif %}{% endfor %}
              {% endfor %}
            </small>
          {% endif %}
          {% if item.observacoes %}<br><small>Obs: {{ item.observacoes }}</small>{% endif %}
        </li>
      {% endfor %}
    </ul>
    <h5>Forma de Pagamento</h5>
    <p>{{ pedido.forma_pagamento.nome }}</p>
    <h5>Endereço de Entrega</h5>
    <p>{{ pedido.cliente.endereco }}, {{ pedido.cliente.bairro }}<br>{{ pedido.cliente.cidade }} - {{ pedido.cliente.estado }}<br>CEP: {{ pedido.cliente.cep }}</p>
  {% else %}
    <div class="alert alert-warning">Pedido não encontrado.</div>
  {% endif %}
</div>
{% endblock %}
